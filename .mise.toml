[tools]
python = "3.13"
uv = "latest"
ruff = "latest"

[env]
_.file = ".env"
# Python environment settings
PYTHONDONTWRITEBYTECODE = "1"
PYTHONUNBUFFERED = "1"

# TradingAgents specific environment variables
TRADINGAGENTS_RESULTS_DIR = "./results"
TRADINGAGENTS_DATA_DIR = "./data"

# Database tasks
[tasks.docker]
description = "Start docker containers"
run = "cd docker && docker compose up -d"

[tasks.install]
description = "Install dependencies using uv"
run = "uv sync --dev"

[tasks.dev]
description = "Run the CLI application (with database)"
depends = ["docker"]
run = "uv run python -m cli.main"

[tasks.run]
description = "Run the main application (with database)"
depends = ["docker"]
run = "uv run python main.py"

[tasks.test]
description = "Run tests with pytest (with database)"
depends = ["docker"]
run = "uv run pytest"

[tasks.coverage]
description = "Run tests with coverage report"
depends = ["docker"]
run = "uv run pytest --cov=tradingagents --cov-report=html --cov-report=term-missing"

[tasks.lint]
description = "Run ruff linting"
run = "ruff check ."

[tasks.format]
description = "Format code with ruff"
run = "ruff format ."

[tasks.typecheck]
description = "Run pyrefly type checking"
run = "uv run pyrefly check ."

[tasks.fix]
description = "Auto-fix linting issues"
run = "ruff check --fix ."

[tasks.all]
description = "Run format, lint, and typecheck"
run = ["ruff format .", "ruff check .", "uv run pyrefly check ."]

[tasks.quality]
description = "Run complete quality check (format, lint, typecheck, test, coverage)"
depends = ["docker"]
run = ["ruff format .", "ruff check .", "uv run pyrefly check .", "uv run pytest --cov=tradingagents --cov-report=term-missing"]

[tasks.ui]
    description = "Start Dagster UI webserver for workflow monitoring"
    depends = ["docker"]
    run = "uv run dagster dev -h 0.0.0.0 -p 3000"

[tasks.dagster-webserver]
    description = "Start Dagster webserver UI for workflow monitoring"
    depends = ["docker"]
    run = "uv run dagster dev -h 0.0.0.0 -p 3000"

[tasks.dagster-daemon]
    description = "Start Dagster daemon for background job execution"
    depends = ["docker"]
    run = "uv run dagster dev -h 0.0.0.0 -p 3000 --daemon"

[tasks.dagster-list]
description = "List all available Dagster jobs and ops"
depends = ["docker"]
run = "uv run dagster job list"

[tasks.dagster-run]
description = "Run a specific Dagster job (usage: mise run dagster-run -- <job_name>)"
depends = ["docker"]
run = "uv run dagster job run"

[tasks.clean]
description = "Clean up cache and build artifacts"
run = [
    "find . -type d -name __pycache__ -exec rm -rf {} +",
    "find . -type f -name '*.pyc' -delete",
    "rm -rf .pytest_cache",
    "rm -rf .ruff_cache",
    "rm -rf dist",
    "rm -rf build",
    "rm -rf *.egg-info",
]
